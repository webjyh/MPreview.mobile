/**
 * @name     MPreview.mobile.js
 * @desc     移动端图片预览插件，支持手势缩放，双击放大，缩小
 * @depend   QuoJS
 * @author   M.J
 * @date     2015-07-12
 * @URL      http://webjyh.com
 * @reutn    {MPreview}
 * @version  1.0.0
 * @license  MIT
 *
 * @PS If you have any questions, please don't look for me, I don't know anything. thank you.
 */
(function(){"use strict";var t,n=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};t=function(){var t,n,e,i,r,o,s,a,u,c,h,l,f,d,g,p,v;return i=[],a=Object.prototype,s=/^\s*<(\w+|!)[^>]*>/,e=[1,9,11],n=/^\.([\w-]+)$/,o=/^#[\w\d-]+$/,h=/^[\w-]+$/,u=document.createElement("table"),c=document.createElement("tr"),r={tr:document.createElement("tbody"),tbody:u,thead:u,tfoot:u,td:c,th:c,"*":document.createElement("div")},t=function(n,e){var i;return n?"function"===t.toType(n)?t(document).ready(n):(i=g(n,e),p(i,n)):p()},t.query=function(t,e){var i;return n.test(e)?i=t.getElementsByClassName(e.replace(".","")):h.test(e)?i=t.getElementsByTagName(e):o.test(e)&&t===document?(i=t.getElementById(e.replace("#","")),i||(i=[])):i=t.querySelectorAll(e),i.nodeType?[i]:Array.prototype.slice.call(i)},t.extend=function(t){return Array.prototype.slice.call(arguments,1).forEach(function(n){var e,i;i=[];for(e in n)i.push(t[e]=n[e]);return i}),t},t.toType=function(t){return a.toString.call(t).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},t.each=function(n,e){var i,r,o,s,a;if(r=void 0,o=void 0,"array"===t.toType(n))for(r=s=0,a=n.length;a>s;r=++s)i=n[r],e.call(i,r,i)===!1;else for(o in n)e.call(n[o],o,n[o])===!1;return n},t.map=function(n,e){var i,r,o,s;if(s=[],i=void 0,r=void 0,"array"===t.toType(n))for(i=0;i<n.length;)o=e(n[i],i),null!=o&&s.push(o),i++;else for(r in n)o=e(n[r],r),null!=o&&s.push(o);return f(s)},t.mix=function(){var t,n,e,i,r;for(e={},t=0,i=arguments.length;i>t;){n=arguments[t];for(r in n)v(n,r)&&void 0!==n[r]&&(e[r]=n[r]);t++}return e},p=function(t,n){return null==n&&(n=""),t=t||i,t.selector=n,t.__proto__=p.prototype,t},g=function(n,i){var r,o;return r=null,o=t.toType(n),"array"===o?r=l(n):"string"===o&&s.test(n)?(r=d(n.trim(),RegExp.$1),n=null):"string"===o?(r=t.query(document,n),i&&(r=1===r.length?t.query(r[0],i):t.map(function(){return t.query(r,i)}))):(e.indexOf(n.nodeType)>=0||n===window)&&(r=[n],n=null),r},d=function(n,e){var i;return null==e&&(e="*"),e in r||(e="*"),i=r[e],i.innerHTML=""+n,t.each(Array.prototype.slice.call(i.childNodes),function(){return i.removeChild(this)})},l=function(t){return t.filter(function(t){return null!=t?t:void 0})},f=function(t){return t.length>0?i.concat.apply(i,t):t},v=function(t,n){return a.hasOwnProperty.call(t,n)},p.prototype=t.fn={},t.fn.each=function(t){return this.forEach(function(n,e){return t.call(n,e,n)}),this},t.fn.filter=function(n){return t(i.filter.call(this,function(e){return e.parentNode&&t.query(e.parentNode,n).indexOf(e)>=0}))},t.fn.forEach=i.forEach,t.fn.indexOf=i.indexOf,t.version="3.0.6",t}(),this.Quo=this.$$=t,function(t){var n,e,i,r,o,s,a,u,c,h,l,f;return n={TYPE:"GET",MIME:"json"},i={script:"text/javascript, application/javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"},e=0,t.ajaxSettings={type:n.TYPE,async:!0,success:{},error:{},context:null,dataType:n.MIME,headers:{},xhr:function(){return new window.XMLHttpRequest},crossDomain:!1,timeout:0},t.ajax=function(e){var i,s,u,l;if(u=t.mix(t.ajaxSettings,e),u.type===n.TYPE?u.url+=t.serialize(u.data,"?"):u.data=t.serialize(u.data),r(u.url))return o(u);l=u.xhr(),l.onreadystatechange=function(){return 4===l.readyState?(clearTimeout(i),h(l,u)):void 0},l.open(u.type,u.url,u.async),c(l,u),u.timeout>0&&(i=setTimeout(function(){return f(l,u)},u.timeout));try{l.send(u.data)}catch(d){s=d,l=s,a("Resource not found",l,u)}return l},t.get=function(n,e,i,r){return t.ajax({url:n,data:e,success:i,dataType:r})},t.post=function(t,n,e,i){return u("POST",t,n,e,i)},t.put=function(t,n,e,i){return u("PUT",t,n,e,i)},t["delete"]=function(t,n,e,i){return u("DELETE",t,n,e,i)},t.json=function(n,e,i){return t.ajax({url:n,data:e,success:i})},t.serialize=function(t,n){var e,i;null==n&&(n=""),i=n;for(e in t)t.hasOwnProperty(e)&&(i!==n&&(i+="&"),i+=""+encodeURIComponent(e)+"="+encodeURIComponent(t[e]));return i===n?"":i},o=function(n){var i,r,o,s;return n.async?(r="jsonp"+ ++e,o=document.createElement("script"),s={abort:function(){return t(o).remove(),r in window?window[r]={}:void 0}},i=void 0,window[r]=function(e){return clearTimeout(i),t(o).remove(),delete window[r],l(e,s,n)},o.src=n.url.replace(RegExp("=\\?"),"="+r),t("head").append(o),n.timeout>0&&(i=setTimeout(function(){return f(s,n)},n.timeout)),s):console.error("QuoJS.ajax: Unable to make jsonp synchronous call.")},h=function(t,n){t.status>=200&&t.status<300||0===t.status?n.async&&l(s(t,n),t,n):a("QuoJS.ajax: Unsuccesful request",t,n)},l=function(t,n,e){e.success.call(e.context,t,n)},a=function(t,n,e){e.error.call(e.context,t,n,e)},c=function(t,n){var e;n.contentType&&(n.headers["Content-Type"]=n.contentType),n.dataType&&(n.headers.Accept=i[n.dataType]);for(e in n.headers)t.setRequestHeader(e,n.headers[e])},f=function(t,n){t.onreadystatechange={},t.abort(),a("QuoJS.ajax: Timeout exceeded",t,n)},u=function(n,e,i,r,o){return t.ajax({type:n,url:e,data:i,success:r,dataType:o,contentType:"application/x-www-form-urlencoded"})},r=function(t){return RegExp("=\\?").test(t)},s=function(t,e){var i,r;if(r=t,t.responseText){if(e.dataType===n.MIME)try{r=JSON.parse(t.responseText)}catch(o){i=o,r=i,a("QuoJS.ajax: Parse Error",t,e)}"xml"===e.dataType&&(r=t.responseXML)}return r}}(t),function(t){var n,e;return n=["-webkit-","-moz-","-ms-","-o-",""],t.fn.addClass=function(t){return this.each(function(){return this.classList.add(t)})},t.fn.removeClass=function(t){return this.each(function(){return this.classList.remove(t)})},t.fn.toggleClass=function(t){return this.each(function(){var n;return n=this.classList.contains(t)?"remove":"add",this.classList[n](t)})},t.fn.hasClass=function(t){return this.length>0&&this[0].classList.contains(t)},t.fn.listClass=function(){return this.length>0?this[0].classList:void 0},t.fn.style=t.fn.css=function(t,n){var i;return null!=n?this.each(function(){return this.style[t]=n}):(i=this[0],i.style[t]||e(i,t))},t.fn.vendor=function(t,e){var i,r,o,s;for(s=[],r=0,o=n.length;o>r;r++)i=n[r],s.push(this.style(""+i+t,e));return s},e=function(t,n){return document.defaultView.getComputedStyle(t,"")[n]}}(t),function(t){return t.fn.attr=function(n,e){return this.length>0&&"string"===t.toType(n)?null!=e?this.each(function(){return this.setAttribute(n,e)}):this[0].getAttribute(n):void 0},t.fn.removeAttr=function(n){return this.length>0&&"string"===t.toType(n)?this.each(function(){return this.removeAttribute(n)}):void 0},t.fn.data=function(t,n){return this.attr("data-"+t,n)},t.fn.removeData=function(t){return this.removeAttr("data-"+t)},t.fn.val=function(t){return null!=t?this.each(function(){return this.value=t.toString()}):this.length>0?this[0].value:null},t.fn.show=function(){return this.style("display","block")},t.fn.hide=function(){return this.style("display","none")},t.fn.focus=function(){return this[0].focus()},t.fn.blur=function(){return this[0].blur()},t.fn.offset=function(){var t,n;return this.length>0&&(t=this[0].getBoundingClientRect(),n={left:t.left+window.pageXOffset,top:t.top+window.pageYOffset,width:t.width,height:t.height}),n}}(t),function(t){var n,e,i,r,o,s;return i=null,n=/WebKit\/([\d.]+)/,e={Android:/(Android)\s+([\d.]+)/,ipad:/(iPad).*OS\s([\d_]+)/,iphone:/(iPhone\sOS)\s([\d_]+)/,Blackberry:/(BlackBerry|BB10|Playbook).*Version\/([\d.]+)/,FirefoxOS:/(Mozilla).*Mobile[^\/]*\/([\d\.]*)/,webOS:/(webOS|hpwOS)[\s\/]([\d.]+)/},t.isMobile=function(){return this.environment(),i.isMobile},t.environment=function(){var t,n;return i||(n=navigator.userAgent,t=o(n),i={browser:r(n),isMobile:!!t,screen:s(),os:t}),i},r=function(t){var e;return e=t.match(n),e?e[0]:t},o=function(t){var n,i,r;for(i in e)if(r=t.match(e[i])){n={name:"iphone"===i||"ipad"===i||"ipod"===i?"ios":i,version:r[2].replace("_",".")};break}return n},s=function(){return{width:window.innerWidth,height:window.innerHeight}}}(t),function(t){var n,e,i,r,o,s,a,u,c,h,l,f,d;return n=1,r={},i={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"},e={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",touch:"click",orientationchange:"resize"},o=/complete|loaded|interactive/,t.fn.on=function(n,e,i){return null==e||"function"===t.toType(e)?this.bind(n,e):this.delegate(e,n,i)},t.fn.off=function(n,e,i){return null==e||"function"===t.toType(e)?this.unbind(n,e):this.undelegate(e,n,i)},t.fn.ready=function(n){return o.test(document.readyState)?n.call(this,t):t.fn.addEvent(document,"DOMContentLoaded",function(){return n.call(this,t)})},t.fn.bind=function(t,n){return this.forEach(function(e){return f(e,t,n)})},t.fn.unbind=function(t,n){return this.each(function(){return d(this,t,n)})},t.fn.delegate=function(n,e,i){return this.each(function(r,o){return f(o,e,i,n,function(e){return function(i){var r,a;return a=t(i.target).closest(n,o).get(0),a?(r=t.extend(s(i),{currentTarget:a,liveFired:o}),e.apply(a,[r].concat([].slice.call(arguments,1)))):void 0}})})},t.fn.undelegate=function(t,n,e){return this.each(function(){return d(this,n,e,t)})},t.fn.trigger=function(n,e,i){return"string"===t.toType(n)&&(n=c(n,e)),null!=i&&(n.originalEvent=i),this.each(function(){return this.dispatchEvent(n)})},t.fn.addEvent=function(t,n,e){return t.addEventListener?t.addEventListener(n,e,!1):t.attachEvent?t.attachEvent("on"+n,e):t["on"+n]=e},t.fn.removeEvent=function(t,n,e){return t.removeEventListener?t.removeEventListener(n,e,!1):t.detachEvent?t.detachEvent("on"+n,e):t["on"+n]=null},c=function(t,n){var e;return e=document.createEvent("Events"),e.initEvent(t,!0,!0,null,null,null,null,null,null,null,null,null,null,null,null),n&&(e.touch=n),e},f=function(n,e,i,o,s){var c,h,f,d;return e=u(e),f=l(n),h=r[f]||(r[f]=[]),c=s&&s(i,e),d={event:e,callback:i,selector:o,proxy:a(c,i,n),delegate:c,index:h.length},h.push(d),t.fn.addEvent(n,d.event,d.proxy)},d=function(n,e,i,o){var s;return e=u(e),s=l(n),h(s,e,i,o).forEach(function(e){return delete r[s][e.index],t.fn.removeEvent(n,e.event,e.proxy)})},l=function(t){return t._id||(t._id=n++)},u=function(n){var i;return i=("function"==typeof t.isMobile?t.isMobile():void 0)?n:e[n],i||n},a=function(t,n,e){var i;return n=t||n,i=function(t){var i;return i=n.apply(e,[t].concat(t.data)),i===!1&&t.preventDefault(),i}},h=function(t,n,e,i){return(r[t]||[]).filter(function(t){return!(!t||n&&t.event!==n||e&&t.callback!==e||i&&t.selector!==i)})},s=function(n){var e;return e=t.extend({originalEvent:n},n),t.each(i,function(t,i){return e[t]=function(){return this[i]=function(){return!0},n[t].apply(n,arguments)},e[i]=function(){return!1}}),e}}(t),function(t){return t.fn.text=function(t){return null!=t?this.each(function(){return this.textContent=t}):this.length>0?this[0].textContent:""},t.fn.html=function(n){var e;return null!=n?(e=t.toType(n),this.each(function(){return"string"===e?this.innerHTML=n:"array"===e?n.forEach(function(n){return function(e){return t(n).html(e)}}(this)):this.innerHTML+=t(n).html()})):this.length>0?this[0].innerHTML:""},t.fn.remove=function(){return this.each(function(){return null!=this.parentNode?this.parentNode.removeChild(this):void 0})},t.fn.empty=function(){return this.each(function(){return this.innerHTML=null})},t.fn.append=function(n){var e;return e=t.toType(n),this.each(function(){return"string"===e?this.insertAdjacentHTML("beforeend",n):"array"===e?n.forEach(function(n){return function(e){return t(n).append(e)}}(this)):this.appendChild(n)})},t.fn.prepend=function(n){var e;return e=t.toType(n),this.each(function(){return"string"===e?this.insertAdjacentHTML("afterbegin",n):"array"===e?n.each(function(t){return function(n,e){return t.insertBefore(e,t.firstChild)}}(this)):this.insertBefore(n,this.firstChild)})},t.fn.replaceWith=function(n){var e;return e=t.toType(n),this.each(function(){return this.parentNode?"string"===e?this.insertAdjacentHTML("beforeBegin",n):"array"===e?n.each(function(t){return function(n,e){return t.parentNode.insertBefore(e,t)}}(this)):this.parentNode.insertBefore(n,this):void 0}),this.remove()}}(t),function(n){var e,i,r,o;return e="parentNode",n.fn.find=function(e){var i;return i=1===this.length?t.query(this[0],e):this.map(function(){return t.query(this,e)}),n(i)},n.fn.parent=function(t){var n;return n=t?r(this):this.instance(e),i(n,t)},n.fn.children=function(t){var n;return n=this.map(function(){return Array.prototype.slice.call(this.children)}),i(n,t)},n.fn.siblings=function(t){var n;return n=this.map(function(t,n){return Array.prototype.slice.call(n.parentNode.children).filter(function(t){return t!==n})}),i(n,t)},n.fn.get=function(t){return this[t]||null},n.fn.first=function(){return n(this[0])},n.fn.last=function(){return n(this[this.length-1])},n.fn.closest=function(t,e){var i,r;for(r=this[0],i=n(t),i.length||(r=null);r&&i.indexOf(r)<0;)r=r!==e&&r!==document&&r.parentNode;return n(r)},n.fn.next=function(){return o.call(this,"nextSibling")},n.fn.prev=function(){return o.call(this,"previousSibling")},n.fn.instance=function(t){return this.map(function(){return this[t]})},n.fn.map=function(t){return n.map(this,function(n,e){return t.call(n,e,n)})},r=function(t){var e;for(e=[];t.length>0;)t=n.map(t,function(t){return t=t.parentNode,t!==document&&e.indexOf(t)<0?(e.push(t),t):void 0});return e},i=function(t,e){return null!=e?n(t).filter(e):n(t)},o=function(t){var e;for(e=this[0][t];e&&1!==e.nodeType;)e=e[t];return n(e)}}(t),t.Gestures=function(t){var e,i,r,o,s,a,u,c,h,l,f,d,g,p;return p=!1,l={},u=null,d=null,s=["input","select","textarea"],e=function(t){return l[t.name]=t.handler,r(t.events)},i=function(n,e,i){return t(n).trigger(e,i,d)},g=function(t){var e;return e=(t.srcElement||t.target).tagName.toLowerCase(),n.call(s,e)>=0?t.stopPropagation():(p=!0,d=t||event,u=c(t),h("start",t.target,u))},f=function(t){return p?(d=t||event,u=c(t),u.length>1&&d.preventDefault(),h("move",t.target,u)):void 0},a=function(t){return p?(d=t||event,h("end",t.target,u),p=!1):void 0},o=function(){return p=!1,h("cancel")},r=function(n){return n.forEach(function(n){return t.fn[n]=function(e){return t(document.body).delegate(this.selector,n,e)}}),this},h=function(t,n,e){var i,r,o;o=[];for(r in l)i=l[r],i[t]&&o.push(i[t].call(i,n,e));return o},c=function(t){var n,e,i,r,o;for(r=t.touches||[t],o=[],e=0,i=r.length;i>e;e++)n=r[e],o.push({x:n.pageX,y:n.pageY});return o},t(document).ready(function(){var n;return n=t(document.body),n.bind("touchstart",g),n.bind("touchmove",f),n.bind("touchend",a),n.bind("touchcancel",o)}),{add:e,trigger:i}}(t),t.Gestures.add({name:"basic",events:["touch","hold","doubleTap"],handler:function(t){var n,e,i,r,o,s,a,u,c,h,l,f;return e=15,n={TAP:200,DOUBLE_TAP:400,HOLD:400},u=null,f=!0,l=null,h=null,c=null,s=function(e,r){return 1===r.length?(h={time:new Date,x:r[0].x,y:r[0].y},l=e,u=setTimeout(function(){return t.trigger(e,"hold",r[0])},n.HOLD)):i()},o=function(t,n){var r;return null!==h&&(r=a(h,n[0]),r.x>e||r.y>e||n.length>1)?i():void 0},r=function(e,r){var o,s;return h?(o=a(h,r[0]),0!==o.x||0!==o.y?i():(clearTimeout(u),s=new Date,s-h.time<n.TAP?s-c<n.DOUBLE_TAP?(t.trigger(e,"doubleTap",r[0]),c=null):(c=s,t.trigger(e,"touch",r[0])):void 0)):void 0},i=function(){return h=null,f=!1,clearTimeout(u)},a=function(t,n){var e;return e={x:n.x-t.x,y:n.y-t.y}},{start:s,move:o,end:r,cancel:i}}(t.Gestures)}),t.Gestures.add({name:"drag",events:["drag","dragging"],handler:function(t){var n,e,i,r,o,s,a,u,c,h,l,f;return n=window.devicePixelRatio>=2?15:20,f=null,h=null,l=null,c=null,o=function(t,n){return n.length>=2?(f=t,h=n.length,l=s(n)):void 0},r=function(t,n){var e;return n.length===h?(e=a(n),c={touches:n,delta:e},u(!0)):void 0},e=i=function(){return l&&c?(u(!1),h=null,l=null,c=null):void 0},a=function(t){var n;return n=s(t),{x:n.x-l.x,y:n.y-l.y}},s=function(t){var n,e,i,r,o;for(e=0,i=0,r=0,o=t.length;o>r;r++)n=t[r],e+=parseInt(n.x),i+=parseInt(n.y);return{x:e/t.length,y:i/t.length}},u=function(e){return e?t.trigger(f,"dragging",c):Math.abs(c.delta.x)>n||Math.abs(c.delta.y)>n?t.trigger(f,"drag",c):void 0},{start:o,move:r,end:i}}(t.Gestures)}),t.Gestures.add({name:"pinch",events:["pinch","pinching","pinchIn","pinchOut"],handler:function(t){var n,e,i,r,o,s,a,u,c,h;return n=window.devicePixelRatio>=2?15:20,h=null,c=null,u=null,o=function(t,n){return 2===n.length?(h=t,c=a(n[0],n[1])):void 0},r=function(t,n){var e;return c&&2===n.length?(e=a(n[0],n[1]),u={touches:n,delta:e-c},s(!0)):void 0},e=i=function(){return c&&u?(s(!1),c=null,u=null):void 0},a=function(t,n){return Math.sqrt((n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y))},s=function(e){var i;return e?t.trigger(h,"pinching",u):Math.abs(u.delta)>n?(t.trigger(h,"pinch",u),i=u.delta>0?"pinchOut":"pinchIn",t.trigger(h,i,u)):void 0},{start:o,move:r,end:i}}(t.Gestures)}),t.Gestures.add({name:"rotation",events:["rotate","rotating","rotateLeft","rotateRight"],handler:function(t){var n,e,i,r,o,s,a,u,c,h,l,f,d;return n=5,e=20,d=null,c=0,f=null,u=null,s=function(t,n){return 2===n.length?(d=t,c=0,f=h(n[0],n[1])):void 0},o=function(t,n){var i;return f&&2===n.length?(i=h(n[0],n[1])-f,u&&Math.abs(u.delta-i)>e&&(i+=360*l(u.delta)),Math.abs(i)>360&&(c++,i-=360*l(u.delta)),u={touches:n,delta:i,rotationsCount:c},a(!0)):void 0},i=r=function(){return f&&u?(a(!1),d=null,c=0,f=null,u=null,f=null):void 0},l=function(t){return 0>t?-1:1},h=function(t,n){var e;return e=Math.atan2(t.y-n.y,t.x-n.x),180*(0>e?e+2*Math.PI:e)/Math.PI},a=function(e){var i;return e?t.trigger(d,"rotating",u):Math.abs(u.delta)>n?(t.trigger(d,"rotate",u),i=u.delta>0?"rotateRight":"rotateLeft",t.trigger(d,i,u)):void 0},{start:s,move:o,end:r}}(t.Gestures)}),t.Gestures.add({name:"swipe",events:["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","swiping","swipingHorizontal","swipingVertical"],handler:function(t){var n,e,i,r,o,s,a,u,c,h,l;return n=Math.round(20/window.devicePixelRatio),l=null,c=null,h=null,u=null,o=function(t,n){return 1===n.length?(l=t,c=n[0],u=null):void 0},r=function(t,n){var e,i;return 1===n.length?(e={x:n[0].x-c.x,y:n[0].y-c.y},i=null===u,u={x:n[0].x,y:n[0].y,delta:e},s(!0,i)):u=null},e=i=function(t,n){var e;return null==u&&n.length>=1&&(e={x:n[0].x-c.x,y:n[0].y-c.y},u={x:n[0].x,y:n[0].y,delta:e}),u?(s(!1),u=null):void 0},s=function(e,i){var r,o,s,c,f;if(null==i&&(i=!1),e)return i&&(h=a(u.delta.x,u.delta.y)),null!==h&&t.trigger(l,"swiping"+h,u),t.trigger(l,"swiping",u);if(o=[],Math.abs(u.delta.y)>n?o.push(u.delta.y<0?"Up":"Down"):Math.abs(u.delta.x)>n&&o.push(u.delta.x<0?"Left":"Right"),o.length){for(t.trigger(l,"swipe",u),f=[],s=0,c=o.length;c>s;s++)r=o[s],f.push(t.trigger(l,"swipe"+r,u));return f}},a=function(t,n){var e;return e=null,Math.round(Math.abs(t/n))>=2?e="Horizontal":Math.round(Math.abs(n/t))>=2&&(e="Vertical"),e},{start:o,move:r,end:i}}(t.Gestures)})}).call(this),function(t,n){"use strict";var e,i=/scale(?:3d)?\(([^\)]+)\)/,r=/translate(?:3d)?\(([^\)]+)\)/,o={url:null,data:null,title:"【浏览】",params:{},wrap:"body",direction:"top",placeholder:"images/placeholder.gif",init:null,close:null},s='<div class="ui-MPreview-wrap">   <div class="ui-MPreview-row">       <div class="ui-MPreview-toolbar">            <div class="ui-MPreview-back"><a href="javascript:;">〈</a></div>            <div class="ui-MPreview-title">{{title}}</div>            <div class="ui-MPreview-pages"><span class="ui-MPreview-currentPage">00</span>/<span class="ui-MPreview-countPage">00</span></div>        </div>        <div class="ui-MPreview-view">            <div class="ui-MPreview-imgbox">                <ul class="ui-MPreview-imglist"></ul>            </div>            <div class="ui-MPreview-loading"></div>        </div>   </div></div>',a=function(t,n){var e,t=t||{};for(e in n)void 0===t[e]&&(t[e]=n[e]);return t},u=function(){var t,n=document.createElement("div"),e={WebkitTransition:"webkitTransitionEnd",OTransition:"oTransitionEnd",MozTransition:"transitionend",transition:"transitionend"};for(t in e)if(void 0!==n.style[t])return e[t]},c=function(t){return t.toString().length<2?"0"+t:t},h=function(t){return new h.fn.init(t)};h.fn=h.prototype={constructor:h,init:function(t){return e=u(),this.config=a(t,o),this.topics={},"function"==typeof this.config.init&&this.config.init(),this._action(),this.publish("init").publish("ajax").publish("touch").publish("zoom").publish("resize"),this},subscribe:function(t,n){return this.topics[t]||(this.topics[t]=[]),this.topics[t].push(n),this},unsubscribe:function(t){return this.topics[t]&&delete this.topics[t],this},publish:function(t){if(!this.topics[t])return!1;var n=this.topics[t],e=n?n.length:0,i=[].slice.call(arguments);i.shift();for(var r=0;e>r;r++)n[r].apply(this,i);return this},getTransform:function(t,e){t=n(t);var o,s,a,u,c=t.css("transform")||t.css("-webkit-transform"),h="none"===c;return"translate"===e?(u=r,(h||-1==c.indexOf(e))&&(h=!0,s=a=0)):"scale"===e&&(u=i,(h||-1==c.indexOf(e))&&(h=!0,s=a=1)),h||(o=c.match(u),o=o[1].split(","),s=parseFloat(o[0]),a=parseFloat(o[1])),{x:s,y:a}},scale:function(t){if(!t.width||!t.height)return{width:"100%",height:"100%"};var n,e=t.width,i=t.height,r=parseInt(this.offset.width),o=parseInt(this.offset.height);return e>r&&(n=r/e,e=r,i=Math.floor(i*n)),i>o&&(n=o/i,i=o,e=Math.floor(e*n)),{width:e,height:i}},distance:function(t,n){if(t&&n){var e=(t.x+n.x)/2,i=(t.y+n.y)/2;return{x:e,y:i}}},getOrigin:function(t,e){var i,r,o,s,a,u=void 0===e?t.touch.x:this.distance(t.touch.touches[0],t.touch.touches[1]).x,c=void 0===e?t.touch.y:this.distance(t.touch.touches[0],t.touch.touches[1]).y,h={width:void 0===e?this.size[this.index-1].width:parseInt(n(t.target).css("width"))*e,height:void 0===e?this.size[this.index-1].height:parseInt(n(t.target).css("height"))*e},l=void 0===e?this.scale(h):{width:parseInt(n(t.target).css("width")),height:parseInt(n(t.target).css("height"))},f=this.screen,d=e||h.width/l.width,g=(f.width-l.width)/2,p=(f.height-l.height)/2,v=u-g,m=c-p;return h.width<=parseInt(this.offset.width,10)&&h.height<=parseInt(this.offset.height,10)?!1:(h.width>f.width?(i=h.width-l.width,r=(i*(v/l.width)-g)/d,o=0-(i*((l.width-v)/l.width)-g)/d,0>r&&(r=0,v=g/i*l.width,o=0-(i*((l.width-v)/l.width)-g)/d),o>0&&(o=0,v=l.width-g/i*l.width,r=i*(g/l.width)/d)):v=l.width/2,h.height>f.height?(i=h.height-l.height,s=(i*(m/l.height)-p)/d,a=0-(i*((l.height-m)/l.height)-p)/d,0>s&&(s=0,m=p/i*l.height,a=0-(i*((l.height-m)/l.height)-p)/d),a>0&&(a=0,m=l.height-p/i*l.height,s=(i*(m/l.height)-p)/d)):m=l.height/2,{scale:d,x:v+"px",y:m+"px",scope:{maxTx:r,minTx:o,maxTy:s,minTy:a}})},destroy:function(){var t;"function"==typeof this.config.close&&(t=this.config.close()),t!==!1&&(n(this.config.wrap).empty(),n(this.config.wrap).removeAttr("style"),n(document).off("touchmove"),n(window).off(this.resizeType))},_action:function(){return this.subscribe("init",function(){var t=this,e="width: 100%; height: 100%; overflow: hidden; background: #000";this.data=null,this.DOM=null,this.index=1,this.size={},this.isExec=!1,this.touch=null,this.isScroll=!1,this.isScale=!1,this.isZoom=!1,this.imgMoveData=null,this.zoomInertia=null,this.zoomRecord=1,this.screen={width:window.innerWidth,height:window.innerHeight},this.resizeType="number"==typeof window.orientation?"orientationchange":"resize",this.config.direction="left"==this.config.direction?!0:!1,n(t.config.wrap)[0].style.cssText=e,n(document).on("touchmove",function(t){t.preventDefault()})}),this.subscribe("init",function(){var t,e={},i=s.replace("{{title}}",this.config.title),r=n(this.config.wrap),o=this.screen;r.html(i),t=r.find("*"),t.each(function(t,i){if(i.className.indexOf("ui-MPreview-")>-1){var r=i.className.replace("ui-MPreview-","");e[r]=n(i)}});var a=parseInt(e.toolbar.style("height"),10);e.wrap.style("width",o.width+"px"),e.wrap.style("height",o.height+"px"),e.view.style("height",o.height-a+"px"),e.view.style("top",a+"px"),this.offset={width:e.view.style("width"),height:e.view.style("height")},this.DOM=e}),this.subscribe("init",function(){var t=this;this.DOM.back.on("touch",function(n){n.preventDefault(),t.destroy()})}),this.subscribe("load",function(t,e,i){var r=this,o=function(t){r.size[e]||(r.size[e]=t),i&&i.call(r,t),setTimeout(function(){r.DOM.loading.addClass("ui-MPreview-hide")},100)};n.each(t,function(t,n){r.DOM.loading.removeClass("ui-MPreview-hide");var e=new Image;e.src=n,e.complete?o({width:e.width,height:e.height}):e.onload=function(){o({width:e.width,height:e.height}),e.onload=null}})}),this.subscribe("ajax",function(){if(this.config.data||this.config.url){var t=this,e=function(t){this.data=t.imgs,this.publish("load",[t.imgs[0]],0,function(t){this.publish("append",t).publish("setPage").publish("preloading","next")})};return this.config.data&&this.config.data.length?void e.call(this,{imgs:this.config.data}):void n.ajax({url:this.config.url,data:this.config.params,dataType:"json",success:function(n){n.code>0&&n.imgs&&n.imgs.length&&e.call(t,n)},error:function(){alert("获取数据失败")}})}}),this.subscribe("append",function(t){var n="",e=this.DOM,i='<li data-index="{{index}}" style="width: '+this.offset.width+"; height: "+this.offset.height+';"><img src="{{src}}" style="width: {{width}}; height: {{height}};" /></li>',r=this.data.length>2?3:this.data.length;t=this.scale(t);for(var o=0;r>o;o++){var s=0===o?this.data[o]:this.config.placeholder,a=0===o?t.width+"px":"100%",u=0===o?t.height+"px":"100%";n+=i.replace("{{index}}",o).replace("{{src}}",s).replace("{{width}}",a).replace("{{height}}",u)}e.imglist.html(n),e.imglist.style(this.config.direction?"width":"height",parseInt(this.offset[this.config.direction?"width":"height"],10)*r+"px"),e.imglist.vendor("transform-origin","50% 50% 0px"),e.imgbox.addClass("ui-MPreview-show"),e.loading.addClass("ui-MPreview-hide")}),this.subscribe("append",function(){this.DOM.countPage.text(c(this.data.length))}),this.subscribe("setPage",function(){this.DOM.currentPage.text(c(this.index))}),this.subscribe("preloading",function(t,e){var i=document.createElement("li"),r=this,o=this.DOM,s="next"==t?this.index+1:this.index-1,a=function(t,n,i){r.publish("load",[n],i,function(i){i=r.scale(i),t.html('<img src="'+n+'" style="width: '+i.width+"px; height: "+i.height+'px" />'),e&&e()})};if(s--,i.style.width=r.offset.width,i.style.height=r.offset.height,!(0>s||s>this.data.length-1||"prev"==t&&this.index==this.data.length-1)){if("next"==t&&r.index<3)return void a(n(o.imglist.find("li").get(r.index)),this.data[s],s);i.setAttribute("data-index",s),o.imglist.find("li")["next"==t?"first":"last"]().remove(),o.imglist["next"==t?"append":"prepend"](i),a(n(i),this.data[s],s)}}),this.subscribe("touchStyle",function(t,n,e,i){var r=this.DOM.imglist;t=t||0,n=n||0,e=e||0,r.vendor("transition","-webkit-transform "+t+"ms "+i+" 0s"),r.vendor("transform","translate3d("+n+"px, "+e+"px, 0px)")}),this.subscribe("touch",function(){var t,n,i,r,o=this,s=parseInt(o.offset.width,10),a=parseInt(o.offset.height,10),u=parseInt(parseInt(this.offset.width)/3,10),c=parseInt(parseInt(this.offset.height)/3,10),h=this.DOM,l=function(){if(o.isScroll=!1,o.isExec=!1,r){o.publish("preloading",i?"next":"prev");var t=(o.index-1)*(o.config.direction?s:a)-(o.config.direction?s:a);1==o.index&&(t=0),o.index==o.data.length&&(t-=o.config.direction?s:a),h.imglist.style(o.config.direction?"left":"top",0>t?"0px":t+"px")}};h.imgbox.on("touchstart",function(e){e.preventDefault(),o.isExec||o.isScale||e.touches.length>1||(t=e.touches[0].clientX,n=e.touches[0].clientY)}),h.imgbox.on("touchmove",function(e){if(e.preventDefault(),!(o.isExec||o.isScale||e.touches.length>1)){var r=Math.abs(o.config.direction?e.touches[0].clientX-t:e.touches[0].clientY-n);1===e.touches.length&&r>20&&(o.isScroll=!0);var s,a=e.touches[0],u=a.clientX,c=a.clientY,h=o.index>1?(o.index-1)*parseInt(o.config.direction?o.offset.width:o.offset.height,10):0;i=o.config.direction?t-u>0?!0:!1:n-c>0?!0:!1;var l=Math.abs(o.config.direction?t-u:n-c);s=i||1!=o.index?i?-(l+h):-(h-l):l,o.config.direction?o.publish("touchStyle",0,s,0,"ease"):o.publish("touchStyle",0,0,s,"ease")}}),h.imgbox.on("touchend",function(e){if(e.preventDefault(),!(o.isExec||o.isScale||e.touches.length>1)){var h=e.changedTouches[0],l=h.clientX,f=h.clientY;o.isExec=!0,r=o.config.direction?Math.abs(t-l)>u:Math.abs(n-f)>c,r&&(i?o.index++:o.index--),o.index>o.data.length&&(o.index=o.data.length),o.index<1&&(o.index=1);var d=-(o.index-1)*(o.config.direction?s:a);o.config.direction?o.publish("touchStyle",300,d,0,"ease-out"):o.publish("touchStyle",300,0,d,"ease-out"),r&&o.publish("setPage")}}),h.imgbox.on(e,l)}),this.subscribe("untouch",function(){var t=this.DOM;t.imgbox.off("touchstart"),t.imgbox.off("touchmove"),t.imgbox.off("touchend"),t.imgbox.off(e)}),this.subscribe("zoom",function(){var t=this.DOM,e=this;t.imglist.on("doubleTap","li",function(t){e.publish(e.isScale?"zoomOut":"zoomIn",t)}),t.imglist.on("pinchIn","img",function(t){if(t.preventDefault(),!e.isScroll){var i=n(t.target);i.off("touchstart"),i.off("touchmove"),e.zoomInertia.scale<=1?(e.isScale=!1,i.vendor("transition","-webkit-transform 300ms ease 0s"),i.vendor("transform-origin",e.zoomInertia.x+" "+e.zoomInertia.y+" 0px"),i.vendor("transform","scale3d(1, 1, 1)")):e.zoomInertia.scope&&(i.on("touchstart",function(t){e.publish("imgTouchStart",t,this)}),i.on("touchmove",function(t){e.publish("imgTouchMove",t,this,e.zoomInertia.scope)})),e.publish("zoomRecord",t.target)}}),t.imglist.on("pinching","img",function(t){t.preventDefault(),e.isScroll||e.publish("zoomInertia",t)}),t.imglist.on("pinchOut","img",function(t){if(t.preventDefault(),!e.isScroll){var i=n(t.target);i.off("touchstart"),i.off("touchmove"),e.zoomInertia.scope&&(i.on("touchstart",function(t){e.publish("imgTouchStart",t,this)}),i.on("touchmove",function(t){e.publish("imgTouchMove",t,this,e.zoomInertia.scope)})),e.publish("zoomRecord",t.target)}}),t.imglist.on("touchend","img",function(t){t.touches.length||e.isScale||!e.isZoom||(e.isZoom=!1,e.isExec=!1,setTimeout(function(){e.publish("touch")},10))})}),this.subscribe("zoomRecord",function(t){this.zoomRecord=this.getTransform(t,"scale").x}),this.subscribe("zoomIn",function(t){var e=this,i="IMG"===t.target.nodeName?n(t.target):n(t.target).find("img").first(),r=this.getOrigin(t);r&&(e.isZoom=!0,this.publish("untouch"),this.isScale=!0,i.on("touchstart",function(t){e.publish("imgTouchStart",t,this)}),i.on("touchmove",function(t){e.publish("imgTouchMove",t,this,r.scope)}),i.vendor("transform-origin",r.x+" "+r.y+" 0px"),i.vendor("transition","-webkit-transform 300ms ease-out 0s"),i.vendor("transform","scale3d("+r.scale+", "+r.scale+", 1)"),this.publish("zoomRecord",i[0]))}),this.subscribe("zoomOut",function(t){var e="IMG"!==t.target.nodeName?n(t.target).find("img").first():n(t.target),i=e.css("transform-origin")||e.css("-webkit-transform-origin");this.isScale=!1,this.isZoom=!1,e.off("touchstart"),e.off("touchmove"),e.vendor("transform-origin",i),e.vendor("transition","-webkit-transform 300ms ease-out 0s"),e.vendor("transform","scale3d(1, 1, 1)"),this.publish("touch"),this.publish("zoomRecord",e[0])}),this.subscribe("zoomInertia",function(t){t.preventDefault();var e,i,r,o=n(t.target),s=t.touch.delta,a=parseInt(o.css("width"),10),u=a*this.zoomRecord,c=this.size[this.index-1].width,h=c/a;0!==s&&(this.isScale||(this.isScale=!0,this.isZoom=!0,this.publish("untouch")),s>0?(r=s/u*c,e=Math.abs(1-(u+r)/u),i=this.zoomRecord+e):(r=s/a*u,e=Math.abs(1-(a+r)/a),i=this.zoomRecord-e),.5>i&&(i=.5),i>h&&(i=h),this.zoomInertia=this.getOrigin(t,i),this.zoomInertia||(this.zoomInertia={scale:i,x:"50%",y:"50%"}),this.imgMoveData={scale:{x:i,y:i},client:{x:t.touch.touches[0].x,y:t.touch.touches[0].y}},o.vendor("transition","-webkit-transform 0ms ease 0s"),o.vendor("transform-origin",this.zoomInertia.x+" "+this.zoomInertia.y+" 0px"),o.vendor("transform","scale3d("+i+", "+i+", 1)"))}),this.subscribe("imgTouchStart",function(t,e){var i=this.getTransform(e,"scale"),r=t.touches[0];this.imgMoveData={scale:i,client:{x:r.clientX,y:r.clientY}},n(e).vendor("transition","-webkit-transform 0ms ease 0s")}),this.subscribe("imgTouchMove",function(t,e,i){t.preventDefault();var r=this.getTransform(e,"translate"),o=n(e),s=this.imgMoveData,a=t.touches,u=a[0].clientX,c=a[0].clientY,h=(u-s.client.x)/s.scale.x,l=(c-s.client.y)/s.scale.y;a.length>1||void 0===s.scale.x||void 0===s.scale.y||(this.imgMoveData.client.x=a[0].clientX,this.imgMoveData.client.y=a[0].clientY,void 0!==i.maxTx&&void 0!==i.minTx&&(r.x+=h,r.x>i.maxTx?r.x=i.maxTx:r.x<i.minTx&&(r.x=i.minTx)),void 0!==i.maxTy&&void 0!==i.minTy&&(r.y+=l,r.y>i.maxTy?r.y=i.maxTy:r.y<i.minTy&&(r.y=i.minTy)),o.vendor("transform","scale3d("+s.scale.x+", "+s.scale.y+", 1) translate3d("+r.x+"px, "+r.y+"px, 0px)"))}),this.subscribe("resize",function(){var t,e=this.DOM,i=this,r=function(){i.screen={width:window.innerWidth,height:window.innerHeight},i.isExec=!1,i.isZoom=!1,i.isScroll=!1,i.isScale=!1;var t=parseInt(e.toolbar.style("height"),10),r=i.screen.width,o=i.screen.height,s=o-t,a=(i.index-1)*(i.config.direction?r:s)-(i.config.direction?r:s),u=-(i.index-1)*(i.config.direction?r:s);1==i.index&&(a=0),i.index==i.data.length&&(a-=i.config.direction?r:s),i.offset={width:r+"px",height:s+"px"},e.wrap[0].style.cssText="width: "+r+"px; height: "+o+"px;",e.view[0].style.cssText="top: "+t+"px; height: "+s+"px;",e.imglist.find("li").each(function(t,e){var r=n(e).find("img"),o=parseInt(n(e).attr("data-index"),10),s=i.size[o]&&i.scale(i.size[o]);e.style.cssText="width:"+i.offset.width+"; height: "+i.offset.height+";",s&&(r[0].style.cssText="width: "+s.width+"px; height: "+s.height+"px;"),r.vendor("transform-origin","50% 50% 0px"),r.vendor("transition","-webkit-transform 0ms ease 0s"),r.vendor("transform","scale3d(1, 1, 1) translate3d(0px, 0px, 0px);"),r.off("touchstart"),r.off("touchmove")}),e.imglist.css(i.config.direction?"left":"top",0>a?"0px":a+"px"),e.imglist.css(i.config.direction?"width":"height",(i.config.direction?r:s)*(i.data.length>2?3:i.data.length)+"px"),i.config.direction?i.publish("touchStyle",0,u,0,"ease"):i.publish("touchStyle",0,0,u,"ease"),i.publish("untouch").publish("touch")};n(window).on(i.resizeType,function(){clearTimeout(t),t=setTimeout(r,300)})}),this}},h.fn.init.prototype=h.fn,t.MPreview=h}(window,$$);